# Задание 1. Предложите системный дизайн крупного онлайн магазина

> Ярмолинский Арсений

## Функциональные требования
  
1. Клиент по умолчанию попадает на главную страницу где показаны:
    - каталог товаров
    - рекомендации по товарам на основе его истории покупок
    - последние купленные товары
2. Клиент может с помощью каталога товаров переходить по категориям и открыть любой товар в магазине
3. Клиент имеет возможность найти товары с помощью поиска по товарам
4. Поиск должен быть с историей последних запросов и предсказанием вероятных продолжений строки. Также он должен искать товары не четко по буквенно, предугадывая возможные вариации названий
5. Клиент может смотреть магазин анонимно либо авторизовавшись. Для авторизации можно использовать номер телефона, электронную почту или OAuth

## Нефункциональные требования

1. FCP для любых пользователей менее 0.5 сек для 90 перцентиля
2. TTI < 2 сек для 90 перцентиля
3. Главная страница сайта должна выдерживать нагрузку в 1000CPS

## Архитектура системы

![](system.svg)

## Выбор баз данных

### Item service

Поскольку все товары имеют очень разные и не обобщаемые категории имеет смысл использовать документную БД. Она позволит искать товары по категориям и их параметрам, при том что у всех товаров эти параметры разные. Например у телевизора есть диагональ и разрешение, а у металлического кронштейна максимальная нагрузка и геометрические размеры.

### Recomendation service

Для сервиса рекомендаций самым главным является быстро обрабатывать большое количество однотипных данных, игнорируя все ненужное. Например смотреть названия товаров в истории или какие-либо сохраненные метрики. Таким образом имеет смысл использовать колоночную БД для более эффективного извлечения интересующей информации.

### History service

Историю имеет смысл хранить в реляционной базе данных для извлечения конкретной информации по пользователе или по времени заказа.

### Catalogue

Для хранения информации об иерархии товаров и их категориях имеет смысл использовать графовую БД. Она очень хорошо описывает сложные взаимодействия и классификации различных товаров, которые могут быть представалены в магазине.

### Search service

Поисковый алгоритм использует Elastic search как проверенное и рабочее решение для создания поисковых сервисов.

### Auth

В сервисе аутентификации используется key-value БД, для отслеживания состояния выданных токенов и активности сессий, поскольку любое обращение к бэкэнду проходит через этот сервис и должно быть обработано как можно быстрее.

## Сценарии работы

### Клиент по умолчанию попадает на главную страницу

В момент перехода на главную страницу магазина производится аутентификация пользователя (либо как анонимного, либо как уже зарегистрированного) и прокси-сервер выдает идентификатор сессии с помощью которого ведется дальнейшие обращения к сервису и сохранение информации о пользователе. Этот идентификатор сохраняется в key-value БД для быстрого определения и перенаправления запросов. После рукопожатия фронтэнд запрашивает информацию о каталоге товаров и рекомендациях для конкретного пользователя и отображает это на экране.

### Клиент может с помощью каталога товаров переходить по категориям и открыть любой товар в магазине

При переходе по ссылкам каталога товаров авторизованный пользователь получает информацию о подкаталогах и товарах внутри данного каталога от сервисов Catalogue и Item service. Каждое перемещение и открытие товара заносится в историю и используется для дальнейших рекомендаций.

### Клиент имеет возможность найти товары с помощью поиска по товарам

Помимо ручного перемещения по каталогам возоможно использование поиска, который позволяет искать товары по их описанию и предугадывать возможные предпочтения пользователя используя историю поисков.
